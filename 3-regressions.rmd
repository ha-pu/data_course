---
title: "Regression Analysis"
author: Harald Puhr
date: "April 7, 2025"
---

[Data Source](https://github.com/ha-pu/data_files/blob/main/README.md#car-evaluation-dataset)

# Load tidyverse package and data

```{r}
library(sjPlot)
library(tidyverse)
```

```{r}
df <- read_csv("https://raw.githubusercontent.com/ha-pu/data_files/refs/heads/main/2-car_acceptance.csv")
df$lug_boot <- factor(df$lug_boot, levels = c("FALSE", "TRUE"))
df$safety <- factor(df$safety, levels = c("low", "med", "high"))
df$doors <- factor(df$doors, levels = c("2", "3", "4", "5more"))
df$persons <- factor(df$persons, levels = c("2", "4", "more"))
```

# Basic data exploration

```{r}
summary(df)
```

```{r}
df %>%
    ggplot() +
    geom_histogram(aes(x = class), bins = 25) +
    theme_bw()
```

```{r}
df %>%
    select(where(is.numeric)) %>%
    cor()
```

# Intercept-only model

## Fit model

```{r}
mod1 <- lm(class ~ 1, data = df)
```

```{r}
tab_model(mod1)
```

## Questions

+ Does the intercept-only model tell us anything about the data?

# Direct effects model

## Fit model

```{r}
mod2 <- lm(class ~ doors + persons + lug_boot + safety, data = df)
mod3 <- lm(class ~ buying + maint, data = df)
mod4 <- lm(class ~ doors + persons + lug_boot + safety + buying + maint, data = df)
```

```{r}
tab_model(mod2, mod3, mod4)
```

```{r}
tibble(
    actual = df$class,
    mod2 = predict(mod2),
    mod3 = predict(mod3),
    mod4 = predict(mod4)
) %>%
    pivot_longer(cols = -actual) %>%
    ggplot() +
    geom_point(aes(x = actual, y = value, colour = name)) +
    geom_smooth(aes(x = actual, y = value, colour = name), method = "lm", se = FALSE) +
    geom_abline(slope = 1, intercept = 0) +
    labs(
        x = "Actual class",
        y = "Predicted class",
        colour = NULL
    ) +
    theme_bw()
```

## Questions

+ What should the product managers do to increase the car acceptance?
+ Which features have the strongest relationship with acceptance? Why might that be the case?

# Interaction metric x metric

## Fit model

```{r}
mod5 <- lm(class ~ doors + persons + lug_boot + safety + buying + maint + buying:maint, data = df)
```

```{r}
tab_model(mod5)
```

```{r}
plot_model(mod5, type = "pred", terms = c("buying", "maint"))
```

## Questions

+ Should your marketing department offer a discount on mainteance for new customers?
+ Is the direction of the interaction consistent with what you might expect in real life?

# Interaction metric x factor

## Fit model

```{r}
mod6 <- lm(class ~ doors + persons + lug_boot + safety + buying + maint + buying:lug_boot, data = df)
mod7 <- lm(class ~ doors + persons + lug_boot + safety + buying + maint + buying:safety, data = df)
```

```{r}
tab_model(mod6)
```

```{r}
plot_model(mod6, type = "pred", terms = c("buying", "lug_boot"))
```

```{r}
tab_model(mod7)
```

```{r}
plot_model(mod7, type = "pred", terms = c("buying", "safety"))
```

## Questions

+ Does greater storage space justify a higher price?
+ Why might the benefit of a large luggage space decrease as a car becomes more expensive?
+ Does this interaction feel intuitive in a real-world consumer context? If not, what might explain it?
+ Does a higher safety level justify a higher price?
+ Do you think the price of a car should influence class more or less when the car is very safe? Why?

# Interaction factor x factor

## Fit model

```{r}
mod8 <- lm(class ~ doors + persons + lug_boot + safety + buying + maint + lug_boot:safety, data = df)
```


```{r}
tab_model(mod8)
```

```{r}
plot_model(mod8, type = "pred", terms = c("lug_boot", "safety"))
```

## Questions

+ Does greater storage space balance lower safety levels?
+ Imagine two cars with the same features, except one has a big trunk. When would that big trunk boost the car's predicted class score?
+ Why might a large trunk be more valued when the car is also moderately or highly safe?
